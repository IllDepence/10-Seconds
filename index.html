<!DOCTYPE HTML>

<!-- - - - - - - - - - - - - - - - - <html> - - - - - - - - - - - - - - - - -->
<html>

<!-- - - - - - - - - - - - - - - - - <head> - - - - - - - - - - - - - - - - -->
<head>
<title>10 Seconds</title>

<link rel="SHORTCUT ICON" href="favicon.ico" />
<link rel="stylesheet" type="text/css" href="style.css" />
<meta charset="utf-8" />

<!-- - - - - - - - - - - - - - - - - <style> - - - - - - - - - - - - - - - - -->
<style type="text/css">
* {
margin: 0;
padding: 0;
}
#gameField {
background-color: #f0f0f0;
position: absolute;
top: 10px;
left: 10px;
}
.entity {
position: absolute;
}
.solidBlock {
background-image: url('darkgreypixel.png');
background-repeat: repeat;
}
#debug {
position: absolute;
top: 20px;
left: 800px;
}
</style>
<!-- - - - - - - - - - - - - - - - - </style> - - - - - - - - - - - - - - - - -->

</head>
<!-- - - - - - - - - - - - - - - - - </head> - - - - - - - - - - - - - - - - -->


<!-- - - - - - - - - - - - - - - - - <body> - - - - - - - - - - - - - - - - -->
<body>

</body>
<!-- - - - - - - - - - - - - - - - - </body> - - - - - - - - - - - - - - - - -->
<div id="gameField"></div>
<div id="debug"></div>
<script>
/* - - - - - - - [Class] Entity - - - - - - - */
function Entity() {}
Entity.prototype.setX = function(x) {
	this.node.style.left = x+'px';
	}
Entity.prototype.setY = function(y) {
	this.node.style.top = y+'px';
	}
Entity.prototype.init = function(x, y, nd, fld, wi, he, sld, flt) {
	this.field = fld;
	prt = fld.node;
	if(prt instanceof HTMLElement) {
		this.node = nd;
		this.parentNode = prt;
		this.node.className += ' entity';
		this.setX(x);
		this.setY(y);
		this.parentNode.appendChild(this.node);
		this.width = wi;
		this.height = he;
		this.solid = sld;
		this.floating = flt;
		this.xSpeed = 0; // change of x in one tick
		this.ySpeed = 0; //     "     y     "
		}
	}
Entity.prototype.getX = function() {
	return this.node.style.left.substr(0, this.node.style.left.length-2);
	}
Entity.prototype.getY = function() {
	return this.node.style.top.substr(0, this.node.style.top.length-2);
	}
Entity.prototype.accX = function(d) {
	this.xSpeed = this.xSpeed+d;
	}
Entity.prototype.accY = function(d) {
	this.ySpeed = this.ySpeed+d;
	}
Entity.prototype.decel = function() {
	this.xSpeed = this.xSpeed+(this.xSpeed==0 ? 0 : (this.xSpeed>0 ? -1 : 1));
	}
Entity.prototype.collidesWith = function(e) {
	var sLeft = parseInt(this.getX());
	var sRight = parseInt(this.getX()) + parseInt(this.width);
	var sTop = parseInt(this.getY());
	var sBottom = parseInt(this.getY()) + parseInt(this.height);
	var eLeft = parseInt(e.getX());
	var eRight = parseInt(e.getX()) + parseInt(e.width);
	var eTop = parseInt(e.getY());
	var eBottom = parseInt(e.getY()) + parseInt(e.height);
	return ((sRight>=eLeft) && (sLeft<=eRight) && (sBottom>=eTop) && (sTop<=eBottom));
	}
Entity.prototype.preventCollisionWith = function(e) {
	if(!e.solid) return;
	var sLeft = parseInt(this.getX());
	var sRight = parseInt(this.getX()) + parseInt(this.width);
	var sTop = parseInt(this.getY());
	var sBottom = parseInt(this.getY()) + parseInt(this.height);
	var sNLeft = sLeft + this.xSpeed;
	var sNRight = sRight + this.xSpeed;
	var sNTop = sTop + this.ySpeed;
	var sNBottom = sBottom + this.ySpeed;
	var eLeft = parseInt(e.getX());
	var eRight = parseInt(e.getX()) + parseInt(e.width);
	var eTop = parseInt(e.getY());
	var eBottom = parseInt(e.getY()) + parseInt(e.height);
	if(this.xSpeed > 0) { // moving right
		if((sLeft < eLeft) && (sNRight >= eLeft) && (sBottom-1>eTop) && (sTop<eBottom-1)) { // collision from right ahead
			this.setX(eLeft-this.width);
			this.xSpeed = 0;
			}
		}
	if(this.xSpeed < 0) { // moving left
		if((sRight > eRight) && (sNLeft <= eRight) && (sBottom-1>eTop) && (sTop<eBottom-1)) { // collision from left ahead
			this.setX(eRight);
			this.xSpeed = 0;
			}
		}
	if(this.ySpeed < 0) { // moving down
		if((sBottom > eBottom) && (sNTop >= eBottom) && (sRight-1>eLeft) && (sLeft<eRight-1)) { // collision from below ahead
			this.setY(eBottom);
			this.ySpeed = 0;
			}
		}
	if(this.ySpeed > 0) { // moving up
		if((sTop < eTop) && (sNBottom >= eTop) && (sRight-1>eLeft) && (sLeft<eRight-1)) { // collision from above ahead
			this.setY(eTop-this.height);
			this.ySpeed = 0;
			}
		}
	}
Entity.prototype.tick = function() {
	var nextX = parseInt(this.getX()) + parseInt(this.xSpeed);
	var nextY = parseInt(this.getY()) + parseInt(this.ySpeed);
	if(nextX>=0 && (nextX+this.width)<this.field.width) {
		this.setX(nextX);
		}
	else {
		this.xSpeed = 0;
		this.setX(nextX<0 ? 0 : this.field.width-this.width);
		}
	if(nextY>=0 && (nextY+this.height)<this.field.height) {
		this.setY(nextY);
		}
	else {
		this.ySpeed = 0;
		this.setY(nextY<0 ? 0 : this.field.height-this.height);
		}
	}
/* - - - - - - - [Class] Player - - - - - - - */
Player.prototype = new Entity();
Player.prototype.constructor = Player;
function Player(fld) {
	var nd = document.createElement('img');
	nd.src = 'bb.png';
	this.init(0, 0, nd, fld, 10, 10, true, false);
	this.jumplock = 0;
	}
Player.prototype.jump = function() {
	if(this.ySpeed == 0 && this.jumplock==0) this.accY(-15);
	this.jumplock = 1;
	}
/* - - - - - - - [Class] SolidBlock - - - - - - - */
SolidBlock.prototype = new Entity();
SolidBlock.prototype.constructor = SolidBlock;
function SolidBlock(fld, x, y, w, h) {
	var nd = document.createElement('div');
	nd.className = 'solidBlock'
	nd.innerHTML = '.';
	nd.style.width = w+'px';
	nd.style.height = h+'px';
	this.init(x, y, nd, fld, w, h, true, false);
	}
/* - - - - - - - [Class] GameField - - - - - - - */
function GameField() {}
GameField.prototype.init = function(w, h, nd) {
	this.node = nd;
	this.width = w;
	this.height = h;
	if(this.node instanceof HTMLElement) {
		this.node.style.width = w+'px';
		this.node.style.height = h+'px';
		}
	}
/* - - - - - - - [Class] Game - - - - - - - */
function Game() {
	// game field
	this.field = new GameField();
	this.field.init(700, 400, document.getElementById('gameField'));
	this.entities = [];
	// player
	var plyr = new Player(this.field);
	this.player = plyr;
	this.entities.push(plyr);
	// solid blocks
	var sb = new SolidBlock(this.field, 300, 0, 20, 50);
	this.entities.push(sb);
	this.currKeyCodes = [] ;
	this.gravity = 1;
	}
Game.prototype.tick = function() {
	// keyboard input
	for(var i=0; i<this.currKeyCodes.length; i++) {
		switch(this.currKeyCodes[i]) {
			case 32: //space bar
				game.player.jump();
				break;
			case 37: //left
				game.player.accX(-1);
				break;
			case 38: //up
				game.player.jump();
				break;
			case 39: //right
				game.player.accX(1);
				break;
			case 40: //down
				break;
			}
		}
	if(this.currKeyCodes.indexOf(37) == -1 && this.currKeyCodes.indexOf(39) == -1) {
		game.player.decel();
		}
	if(this.currKeyCodes.indexOf(32) == -1 && this.currKeyCodes.indexOf(38) == -1) {
		game.player.jumplock = 0;
		}
	// entities
	for(var i=0; i<this.entities.length; i++) {
		var e = this.entities[i];
		if((parseInt(e.getY())+parseInt(e.height))<this.field.height) {
			e.accY(this.gravity);
			}
		if(i>0) { // for all entities except player
			this.player.preventCollisionWith(e);
			}
		e.tick();
		}
	}

// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
var game = new Game();
// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -

document.onkeydown = function(e) {
	var keyCode = (window.event) ? event.keyCode : e.keyCode;
	if(game.currKeyCodes.indexOf(keyCode) == -1) {
		game.currKeyCodes.push(keyCode);
		}
	}

document.onkeyup = function(e) {
	var keyCode = (window.event) ? event.keyCode : e.keyCode;
	var index = game.currKeyCodes.indexOf(keyCode);
	game.currKeyCodes.splice(index, 1);
	}

// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -

var fps = 60;
function draw() {
	setTimeout(function() {
		requestAnimationFrame(draw);
		//game logic
		}, 1000 / fps);
		game.tick();
	}
draw();

</script>

</html>
<!-- - - - - - - - - - - - - - - - - </html> - - - - - - - - - - - - - - - - -->
